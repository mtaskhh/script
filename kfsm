local Player = game:GetService("Players").LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TreeFarmGUI"
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 200, 0, 120)
MainFrame.Position = UDim2.new(0, 10, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MainFrame.BorderSizePixel = 1
MainFrame.BorderColor3 = Color3.fromRGB(80, 80, 80)
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 20)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -40, 1, 0)
TitleLabel.Position = UDim2.new(0, 5, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "树木农场--Mtaskh"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Font = Enum.Font.Gotham
TitleLabel.TextSize = 12
TitleLabel.Parent = TitleBar

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 20, 0, 20)
MinimizeButton.Position = UDim2.new(1, -40, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 14
MinimizeButton.Parent = TitleBar

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Position = UDim2.new(1, -20, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.Gotham
CloseButton.TextSize = 12
CloseButton.Parent = TitleBar

local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -10, 1, -30)
ContentFrame.Position = UDim2.new(0, 5, 0, 25)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

local StartButton = Instance.new("TextButton")
StartButton.Size = UDim2.new(0.48, 0, 0, 30)
StartButton.Position = UDim2.new(0, 0, 0, 5)
StartButton.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
StartButton.BorderSizePixel = 0
StartButton.Text = "开始"
StartButton.TextColor3 = Color3.fromRGB(255, 255, 255)
StartButton.Font = Enum.Font.Gotham
StartButton.TextSize = 12
StartButton.Parent = ContentFrame

local LoopButton = Instance.new("TextButton")
LoopButton.Size = UDim2.new(0.48, 0, 0, 30)
LoopButton.Position = UDim2.new(0.52, 0, 0, 5)
LoopButton.BackgroundColor3 = Color3.fromRGB(60, 100, 150)
LoopButton.BorderSizePixel = 0
LoopButton.Text = "循环:关"
LoopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LoopButton.Font = Enum.Font.Gotham
LoopButton.TextSize = 12
LoopButton.Parent = ContentFrame

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Position = UDim2.new(0, 0, 0, 40)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "就绪"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 11
StatusLabel.Parent = ContentFrame

local ProgressLabel = Instance.new("TextLabel")
ProgressLabel.Size = UDim2.new(1, 0, 0, 20)
ProgressLabel.Position = UDim2.new(0, 0, 0, 60)
ProgressLabel.BackgroundTransparency = 1
ProgressLabel.Text = "进度: 0/33000"
ProgressLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
ProgressLabel.Font = Enum.Font.Gotham
ProgressLabel.TextSize = 11
ProgressLabel.Parent = ContentFrame

ScreenGui.Parent = PlayerGui

local isMinimized, isRunning, isLooping = false, false, false
local originalSize = MainFrame.Size
local minimizedSize = UDim2.new(0, 200, 0, 20)
local dragInput, dragStart, startPos

local function updateInput(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragStart = input.Position
		startPos = MainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragInput = nil end
		end)
	end
end)

TitleBar.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
	if input == dragInput then updateInput(input) end
end)

MinimizeButton.MouseButton1Click:Connect(function()
	if isMinimized then
		MainFrame.Size = originalSize
		ContentFrame.Visible = true
		MinimizeButton.Text = "_"
		isMinimized = false
	else
		MainFrame.Size = minimizedSize
		ContentFrame.Visible = false
		MinimizeButton.Text = "□"
		isMinimized = true
	end
end)

CloseButton.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

LoopButton.MouseButton1Click:Connect(function()
	isLooping = not isLooping
	LoopButton.Text = "循环:" .. (isLooping and "开" or "关")
	LoopButton.BackgroundColor3 = isLooping and Color3.fromRGB(80, 140, 200) or Color3.fromRGB(60, 100, 150)
end)

StartButton.MouseButton1Click:Connect(function()
	if isRunning then 
		isRunning = false 
		return 
	end
	
	isRunning = true
	StartButton.BackgroundColor3 = Color3.fromRGB(120, 60, 60)
	StartButton.Text = "停止"
	StatusLabel.Text = "砍树中..."
	StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
	
	repeat
		local treesDamaged = 0
		for i = 1, 33000 do
			if not isRunning then break end
			game:GetService("ReplicatedStorage"):WaitForChild("Signal"):WaitForChild("Tree"):FireServer("damage", "World 1_" .. i)
			treesDamaged = treesDamaged + 1
			if i % 100 == 0 then
				ProgressLabel.Text = "进度: " .. i .. "/33000"
				wait()
			end
		end
		if treesDamaged == 33000 then
			StatusLabel.Text = isLooping and "完成,循环中..." or "完成!"
			ProgressLabel.Text = "进度: 33000/33000"
			if not isLooping then break end
			wait(1)
		else
			break
		end
	until not isRunning or not isLooping
	
	isRunning = false
	StartButton.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
	StartButton.Text = "开始"
	StatusLabel.Text = isLooping and "已停止" or "完成!"
	StatusLabel.TextColor3 = isLooping and Color3.fromRGB(255, 150, 150) or Color3.fromRGB(100, 255, 100)
end)
